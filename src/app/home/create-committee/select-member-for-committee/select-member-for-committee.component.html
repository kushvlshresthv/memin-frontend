<div class="member-selection-container" [formGroup]="formData">
  <!-- Search Section -->
  <div class="search-section">
    <input
      type="text"
      class="search-input"
      formControlName="searchBarInput"
      placeholder="Search members..."
    />

      <!-- Selected Members Section -->
      @if (memberSelectionService.selected().length > 0) {
        <div class="selected-members-section">
          <h3 class="section-title">Selected Members</h3>
          <div class="selected-members-list">
            @for (
              selectedMemberWithRole of memberSelectionService.selectedWithRoles();
              track selectedMemberWithRole.member.memberId
            ) {
              @let selectedMember = selectedMemberWithRole.member;
              <div class="selected-member-item">
                <div class="member-info">
                  <span class="selected-name">
                    {{
                      selectedMember.firstName + " " + selectedMember.lastName
                    }}
                  </span>
                </div>
                <select
                  [formControl]="
                    memberAndRoleFormControlMap().get(selectedMember.memberId)!
                  "
                  (change)="onRoleChange(selectedMember)"
                  class="role-select"
                >
                  <!-- this is done so that form control value syncs with the role in the select-member-for-committee-service while restoring form and loading form data for edit page -->
                  {{
                    memberAndRoleFormControlMap()
                      .get(selectedMember.memberId)!
                      .setValue(selectedMemberWithRole.role)
                  }}
                  <option value="remove">Remove</option>
                  <option value="member">Member</option>
                  <option value="treasurer">Treasurer</option>
                  <option
                    [value]="
                      memberAndRoleFormControlMap().get(selectedMember.memberId)!
                        .value
                    "
                  >
                    {{
                      memberAndRoleFormControlMap().get(selectedMember.memberId)!
                        .value
                    }}
                  </option>
                </select>
              </div>
            }
          </div>
        </div>
      }

      <!-- Unselected Members Section -->
      @if (memberSelectionService.displayed().length > 0) {
        <div class="unselected-members-section">
          <h3 class="section-title">Unselected Members</h3>
        </div>
      }

      <div class="available-members">
        @for (
          displayedMember of memberSelectionService.displayed();
          track displayedMember.memberId
        ) {
          <div class="available-member-item">
            <span class="member-name">
              {{ displayedMember.firstName + " " + displayedMember.lastName }}
            </span>
            <select
              [formControl]="
                memberAndRoleFormControlMap().get(displayedMember.memberId)!
              "
              (change)="onRoleSelect(displayedMember)"
              class="role-select compact"
            >
              <option value="Add">Add</option>
              <option value="" disabled>Select Role</option>
              <option value="member">Member</option>
              <option value="treasurer">Treasurer</option>
            </select>
          </div>
        } @empty {
          <div class="empty-state">
            @if (memberSelectionService.selected().length === 0) {
              <span>Select members to add to the committee</span>
            } @else {
              <span>No more members found</span>
            }
          </div>
        }
      </div>
  </div>
</div>
